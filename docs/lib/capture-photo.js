function t(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function e(t,e){return e.get?e.get.call(t):e.value}function i(i,s){return e(i,t(i,s,"get"))}function s(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function n(t,e,i){s(t,e),e.set(t,i)}function a(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}function o(e,i,s){return a(e,t(e,i,"set"),s),s}function h(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function r(t,e){s(t,e),e.add(t)}const l=document.createElement("template");l.innerHTML='\n  <style>\n    :host { all: initial; display: block; box-sizing: border-box; }\n    :host *, :host *::before, :host *::after { box-sizing: inherit; }\n    :host([hidden]), [hidden] { display: none; }\n    :host video { display: block; }\n    :host #output:empty { display: none; }\n  </style>\n  <video part="video" playsinline></video>\n  <canvas hidden></canvas>\n  <div part="actions-container">\n    <slot name="capture-button">\n      <button part="capture-button" type="button">\n        <slot name="capture-button-content">Capture photo</slot>\n      </button>\n    </slot>\n    <slot name="facing-mode-button" hidden>\n      <button part="facing-mode-button" type="button">\n        <slot name="facing-mode-button-content">Toggle facing mode</slot>\n      </button>\n    </slot>\n    <slot name="actions"></slot>\n  </div>\n  <slot></slot>\n  <div part="output-container" id="output"></div>\n';var c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,b=new WeakMap,v=new WeakMap,f=new WeakMap,w=new WeakMap,k=new WeakSet,E=new WeakSet,y=new WeakMap,M=new WeakMap,N=new WeakMap,C=new WeakSet,S=new WeakSet,T=new WeakMap,A=new WeakMap,W=new WeakSet,z=new WeakSet,L=new WeakSet;class x extends HTMLElement{connectedCallback(){if(h(this,L,j).call(this,"noImage"),h(this,L,j).call(this,"facingMode"),h(this,L,j).call(this,"cameraResolution"),h(this,L,j).call(this,"pan"),h(this,L,j).call(this,"tilt"),h(this,L,j).call(this,"zoom"),o(this,c,!0),o(this,p,this.shadowRoot.querySelector("canvas")),o(this,m,this.shadowRoot.getElementById("output")),o(this,g,this.shadowRoot.querySelector("video")),o(this,b,this.shadowRoot.querySelector('slot[name="capture-button"]')),o(this,v,h(this,z,D).call(this)),o(this,f,this.shadowRoot.querySelector('slot[name="facing-mode-button"]')),o(this,w,h(this,W,B).call(this)),i(this,g)?.addEventListener("loadedmetadata",i(this,N)),i(this,b)?.addEventListener("slotchange",i(this,T)),i(this,v)?.addEventListener("click",i(this,M)),i(this,f)?.addEventListener("slotchange",i(this,A)),i(this,w)?.addEventListener("click",i(this,y)),!x.isSupported())return this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:{name:"NotSupportedError",message:"Not supported"}}}));h(this,E,I).call(this)}disconnectedCallback(){h(this,k,R).call(this),i(this,w)?.removeEventListener("click",i(this,y)),i(this,v)?.removeEventListener("click",i(this,M)),i(this,g)?.removeEventListener("canplay",i(this,N)),i(this,b)?.removeEventListener("slotchange",i(this,T)),i(this,f)?.removeEventListener("slotchange",i(this,A))}static get observedAttributes(){return["no-image","facing-mode","camera-resolution","pan","tilt","zoom"]}attributeChangedCallback(t,e,s){if(!i(this,c))return;const n=this.getTrackCapabilities(),a=this.getTrackSettings();if("no-image"===t&&e!==s&&h(this,C,O).call(this),"facing-mode"===t&&e!==s&&i(this,u)?.facingMode){const t=["user","environment"].includes(this.facingMode);a?.facingMode&&t&&(h(this,k,R).call(this),h(this,E,I).call(this))}if("camera-resolution"===t&&e!==s){const[t,e]=this.cameraResolution.split("x").map((t=>Number(t))),i=t>=n?.width?.min&&t<=n?.width?.max,s=e>=n?.height?.min&&e<=n?.height?.max;a?.width&&a?.height&&i&&s&&(h(this,k,R).call(this),h(this,E,I).call(this))}if("pan"===t&&e!==s&&i(this,u)?.pan){const t=this.pan>=n?.pan?.min&&this.pan<=n?.pan?.max;a?.pan&&t&&h(this,S,U).call(this,"pan",this.pan)}if("tilt"===t&&e!==s&&i(this,u)?.tilt){const t=this.tilt>=n?.tilt?.min&&this.tilt<=n?.tilt?.max;a?.tilt&&t&&h(this,S,U).call(this,"tilt",this.tilt)}if("zoom"===t&&e!==s&&i(this,u)?.zoom){const t=this.zoom>=n?.zoom?.min&&this.zoom<=n?.zoom?.max;a?.zoom&&t&&h(this,S,U).call(this,"zoom",this.zoom)}}get noImage(){return this.hasAttribute("no-image")}set noImage(t){t?this.setAttribute("no-image",""):this.removeAttribute("no-image")}get facingMode(){return this.getAttribute("facing-mode")}set facingMode(t){this.setAttribute("facing-mode",t)}get cameraResolution(){return this.getAttribute("camera-resolution")}set cameraResolution(t){this.setAttribute("camera-resolution",t)}get pan(){return Number(this.getAttribute("pan"))||null}set pan(t){this.setAttribute("pan",Number(t)||null)}get tilt(){return Number(this.getAttribute("tilt"))||null}set tilt(t){this.setAttribute("tilt",Number(t)||null)}get zoom(){return Number(this.getAttribute("zoom"))||null}set zoom(t){this.setAttribute("zoom",Number(t)||null)}get loading(){return this.hasAttribute("loading")}capture(){if(!this.loading)try{const t=i(this,p).getContext("2d"),e=i(this,g).videoWidth,s=i(this,g).videoHeight;i(this,p).width=e,i(this,p).height=s,t.drawImage(i(this,g),0,0,e,s);const n=i(this,p).toDataURL("image/png");if("string"==typeof n&&n.includes("data:image")){if(!this.noImage){const t=new Image;t.src=n,t.width=e,t.height=s,t.part="output-image",h(this,C,O).call(this),i(this,m)?.appendChild(t)}this.dispatchEvent(new CustomEvent("capture-photo:success",{bubbles:!0,composed:!0,detail:{dataURI:n,width:e,height:s}}))}}catch(t){this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:t}}))}}getSupportedConstraints(){return x.isSupported()&&navigator.mediaDevices.getSupportedConstraints()||{}}getTrackCapabilities(){if(!i(this,d))return{};const[t]=i(this,d).getVideoTracks();return t&&"function"==typeof t.getCapabilities&&t.getCapabilities()||{}}getTrackSettings(){if(!i(this,d))return{};const[t]=i(this,d).getVideoTracks();return t&&"function"==typeof t.getSettings&&t.getSettings()||{}}static isSupported(){return Boolean(navigator.mediaDevices?.getUserMedia)}static defineCustomElement(t="capture-photo"){"undefined"==typeof window||window.customElements.get(t)||window.customElements.define(t,x)}constructor(){super(),r(this,k),r(this,E),r(this,C),r(this,S),r(this,W),r(this,z),r(this,L),n(this,c,{writable:!0,value:void 0}),n(this,u,{writable:!0,value:void 0}),n(this,d,{writable:!0,value:void 0}),n(this,p,{writable:!0,value:void 0}),n(this,m,{writable:!0,value:void 0}),n(this,g,{writable:!0,value:void 0}),n(this,b,{writable:!0,value:void 0}),n(this,v,{writable:!0,value:void 0}),n(this,f,{writable:!0,value:void 0}),n(this,w,{writable:!0,value:void 0}),n(this,y,{writable:!0,value:t=>{t.preventDefault(),this.loading||(this.facingMode="user"!==this.facingMode&&this.facingMode?"user":"environment")}}),n(this,M,{writable:!0,value:t=>{t.preventDefault(),this.capture()}}),n(this,N,{writable:!0,value:t=>{const e=t.target;e.play().then((()=>{this.dispatchEvent(new CustomEvent("capture-photo:video-play",{bubbles:!0,composed:!0,detail:{video:e}}))})).catch((t=>{this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:t}}))})).finally((()=>{this.removeAttribute("loading")}))}}),n(this,T,{writable:!0,value:t=>{"capture-button"===t.target?.name&&(i(this,v)?.removeEventListener("click",i(this,M)),o(this,v,h(this,z,D).call(this)),i(this,v)&&(i(this,v).addEventListener("click",i(this,M)),"BUTTON"===i(this,v).nodeName||i(this,v).hasAttribute("role")||i(this,v).setAttribute("role","button")))}}),n(this,A,{writable:!0,value:t=>{"facing-mode-button"===t.target?.name&&(i(this,w)?.removeEventListener("click",i(this,y)),o(this,w,h(this,W,B).call(this)),i(this,w)&&(i(this,w).addEventListener("click",i(this,y)),"BUTTON"===i(this,w).nodeName||i(this,w).hasAttribute("role")||i(this,w).setAttribute("role","button")))}}),o(this,c,!1),o(this,u,this.getSupportedConstraints()),this.shadowRoot||(this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(l.content.cloneNode(!0)))}}function R(){if(!i(this,g)||!i(this,d))return;const[t]=i(this,d).getVideoTracks();t?.stop(),i(this,g).srcObject=null,o(this,d,null)}async function I(){if(!x.isSupported())return;this.setAttribute("loading","");const t={video:{facingMode:{ideal:this.facingMode||"user"},pan:!0,tilt:!0,zoom:!0},audio:!1};if("string"==typeof this.cameraResolution){const[e,i]=this.cameraResolution.split("x").map((t=>Number(t)));t.video.width=e,t.video.height=i}try{o(this,d,await navigator.mediaDevices.getUserMedia(t)),i(this,g).srcObject=i(this,d),h(this,S,U).call(this,"pan",this.pan),h(this,S,U).call(this,"tilt",this.tilt),h(this,S,U).call(this,"zoom",this.zoom);this.getTrackSettings()?.facingMode&&(i(this,f).hidden=!1)}catch(t){this.dispatchEvent(new CustomEvent("capture-photo:error",{bubbles:!0,composed:!0,detail:{error:t}}))}finally{this.removeAttribute("loading")}}function O(){i(this,m)&&Array.from(i(this,m).childNodes).forEach((t=>t.remove()))}function U(t,e){if(!i(this,d)||!t||!e)return;const[s]=i(this,d).getVideoTracks(),n=this.getTrackCapabilities();var a,o,h;this.getTrackSettings()?.[t]&&s.applyConstraints({advanced:[{[t]:(a=Number(e),o=n?.[t]?.min,h=n?.[t]?.max,Number.isNaN(o)&&(o=0),Number.isNaN(h)&&(h=0),Math.min(Math.max(a,Math.min(o,h)),Math.max(o,h)))}]})}function B(){return i(this,f)?i(this,f).assignedElements({flatten:!0}).find((t=>"BUTTON"===t.nodeName||"facing-mode-button"===t.getAttribute("slot"))):null}function D(){return i(this,b)?i(this,b).assignedElements({flatten:!0}).find((t=>"BUTTON"===t.nodeName||"capture-button"===t.getAttribute("slot"))):null}function j(t){if(Object.prototype.hasOwnProperty.call(this,t)){const e=this[t];delete this[t],this[t]=e}}export{x as CapturePhoto};
//# sourceMappingURL=capture-photo.js.map
